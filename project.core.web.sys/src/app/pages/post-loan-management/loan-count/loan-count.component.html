<md-sidenav-container>
  <div class="main-container clearfix">
    <search-form *ngIf="searchDOMS" [filters]="searchDOMS" [condition]="filters"
                 (onSearch)="onSearch($event)"></search-form>
  </div>

  <timi-table [headers]="headers" [data]="datas" [clickRowable]="true" [totals]="totals" [pageSize]="pageSize"
              [activeIndex]="currentPage" (pageEvent)="page($event)"
              (clickRowEvent)="rowClickEvent($event);sidenav.open()">
  </timi-table>
  <p class="count-money"><span>总应还金额：<em>{{totalLoanApprovedAmount}}</em></span> &nbsp;&nbsp;<span>总实际还款金额：<em>{{totalActualAmount}}</em></span></p>

  <md-sidenav #sidenav class="sidenav container-fluid" align="end">
    <div class="row">
      <div class="col-lg-12" [ngSwitch]="sidenavKey">
        <!--详细-->
        <ng-container *ngSwitchCase="'Detail'">
          <div class="section clearfix">
            <h4>订单基本信息</h4>
            <div class="form-group columns1">
              <div class="label">交易单编号</div>
              <div class="span">{{orderDetail?.id}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">交易状态</div>
              <div class="span">{{orderDetail?._status}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">机构</div>
              <div class="span"></div>
            </div>
            <div class="form-group columns1">
              <div class="label">产品</div>
              <div class="span">{{orderDetail?._product?.name}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">营业部</div>
              <div class="span">{{orderDetail?.orgName?.name}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">客户</div>
              <div class="span">{{orderDetail?.name}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">申请金额</div>
              <div class="span">{{orderDetail?.applyAmount}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">批贷金额</div>
              <div class="span">{{orderDetail?.loanApprovedAmount}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">年化</div>
              <div class="span">{{orderDetail?._rate?.yearRate}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">放贷时间</div>
              <div class="span">{{orderDetail?.loanDate | date:"yyyy-MM-dd HH:mm:ss"}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">月费率</div>
              <div class="span">{{orderDetail?._rate?.monthRate}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">期数</div>
              <div class="span">{{orderDetail?.loanTerm}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">还款方式</div>
              <div class="span">{{orderDetail?._loanRepaymentMethod}}</div>
            </div>
            <div class="form-group columns1">
              <div class="label">逾期期数</div>
              <div class="span">{{orderDetail?.overdueNumber}}</div>
            </div>
          </div>
          <div class="section clearfix">
            <h4>还款计划</h4>
            <table>
              <thead>
              <tr>
                <th>计划还款时间</th>
                <th>利息</th>
                <th>应还金额</th>
                <th>实际还款时间</th>
                <th>实还滞纳金</th>
                <th>实还金额</th>
                <th>还款凭证</th>
                <th>操作人</th>
                <th>备注</th>
                <th>还款方</th>
                <th>操作</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let item of repaymentPlan">
                <td>{{item?.plannedTime | date:"yyyy-MM-dd"}}</td>
                <td>{{item?.interest}}</td>
                <td>{{item?.interest}}</td>
                <td>{{item?.actualTime | date:"yyyy-MM-dd HH:mm:ss"}}</td>
                <td>{{item?.actualLateFee}}</td>
                <td>{{item?.actualAmount}}</td>
                <td>
                  <img src="{{item?._paymentVoucher}}">
                </td>
                <td>{{item?._user}}</td>
                <td>{{item?.remark}}</td>
                <td>{{item?.repaymentWay}}</td>
                <td>
                  <button md-raised-button (click)="onClickRepayment(item)">还款</button>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
          <div class="section clearfix tac">
            <button md-raised-button (click)="createPlan()">生成还款明细</button>
            <button md-raised-button (click)="onClickRepayment('all')">全额还款</button>
          </div>
        </ng-container>
        <ng-container *ngSwitchCase="'CreatePlan'">
          <form [formGroup]="repaymentPlanForm" (ngSubmit)="submitCreatePlan()">
            <input type="hidden" formControlName="order">
            <div class="form-group columns1">
              <div class="label">放款日期</div>
              <free-calendar lang="cn" formControlName="loanTime"></free-calendar>
              <p class="errors"
                 *ngIf="repaymentPlanForm.controls['loanTime'].dirty && repaymentPlanForm.controls['loanTime'].hasError('required')">
                必填</p>
            </div>
            <div class="form-group columns1">
              <timi-input [labelName]="'年化'" formControlName="yearRate"></timi-input>
              <p class="errors"
                 *ngIf="repaymentPlanForm.controls['yearRate'].dirty && repaymentPlanForm.controls['yearRate'].hasError('required')">
                必填</p>
            </div>
            <div class="form-group columns1">
              <timi-input labelName="月息" formControlName="monthRate"></timi-input>
              <p class="errors"
                 *ngIf="repaymentPlanForm.controls['monthRate'].dirty && repaymentPlanForm.controls['monthRate'].hasError('required')">
                必填</p>
            </div>
            <div class="form-group columns1">
              <timi-select freeSelectName="还款方式" formControlName="repaymentType" [options]="repaymentWay"></timi-select>
              <p class="errors"
                 *ngIf="repaymentPlanForm.controls['repaymentType'].dirty && repaymentPlanForm.controls['repaymentType'].hasError('required')">
                必填</p>
            </div>
            <div class="section clearfix operateBar">
              <button md-raised-button (click)="onClickBack()">返回</button>
              <button md-raised-button type="submit">生成还款计划</button>
            </div>
          </form>
        </ng-container>
        <!--还款-->
        <ng-container *ngSwitchCase="'Repayment'">
          <form [formGroup]="repaymentForm" (ngSubmit)="submitRepayment()">
            <input type="hidden" formControlName="id">
            <div class="section clearfix">
              <div class="form-group columns1">
                <div class="label"><label>还款日期</label></div>
                <free-calendar lang="cn" formControlName="ActualTime"></free-calendar>
                <p class="errors"
                   *ngIf="getFormControl('ActualTime').dirty && getFormControl('ActualTime').hasError('required')">
                  必填</p>
              </div>
              <div class="form-group columns1">
                <timi-input [labelName]="'还款金额'" formControlName="ActualAmount"></timi-input>
                <p class="errors"
                   *ngIf="getFormControl('ActualAmount').dirty && getFormControl('ActualAmount').hasError('required')">
                  必填</p>
              </div>
              <div class="form-group columns1">
                <timi-input [labelName]="'滞纳金'" formControlName="ActualLateFee"></timi-input>
                <p class="errors"
                   *ngIf="getFormControl('ActualLateFee').dirty && getFormControl('ActualLateFee').hasError('required')">
                  必填</p>
              </div>
              <div class="form-group columns1">
                <timi-select [freeSelectName]="'还款类型'" [options]="repaymentTypes"
                             formControlName="RepaymentWay"></timi-select>
                <p class="errors"
                   *ngIf="getFormControl('RepaymentWay').dirty && getFormControl('RepaymentWay').hasError('required')">
                  必填</p>
              </div>
            </div>
            <div class="section clearfix">
              <div class="columns2 upfile" style="margin-bottom: 1rem;">
                <timi-file-uploader [btnName]="'还款凭证'" formControlName="PaymentVoucher"></timi-file-uploader>
                <p class="errors"
                   *ngIf="getFormControl('PaymentVoucher').dirty && getFormControl('PaymentVoucher').hasError('required')">
                  必填</p>
              </div>
            </div>
            <div class="section clearfix">
              <timi-textarea [labelName]="'备注'" formControlName="Remark"></timi-textarea>
            </div>
            <div class="section clearfix operateBar">
              <button md-raised-button (click)="onClickBack()">返回</button>
              <button md-raised-button type="submit">确定</button>
            </div>
          </form>
        </ng-container>
      </div>
    </div>
  </md-sidenav>
</md-sidenav-container>
