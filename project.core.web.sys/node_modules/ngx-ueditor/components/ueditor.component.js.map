{"version":3,"file":"ueditor.component.js","sourceRoot":"","sources":["../../.tmp/components/ueditor.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, forwardRef, ViewChild, ElementRef, OnDestroy, EventEmitter, Output, NgZone, ViewEncapsulation } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\n\nimport { ScriptService } from './script.service';\nimport { UEditorConfig } from './ueditor.config';\n\ndeclare const window: any;\ndeclare const UE: any;\n\nexport type EventTypes = 'destroy' | 'reset' | 'focus' | 'langReady' | 'beforeExecCommand' | 'afterExecCommand' | 'firstBeforeExecCommand' | 'beforeGetContent' | 'afterGetContent' | 'getAllHtml' | 'beforeSetContent' | 'afterSetContent' | 'selectionchange' | 'beforeSelectionChange' | 'afterSelectionChange';\n\n@Component({\n    selector: 'ueditor',\n    template: `\n    <textarea #host class=\"ueditor-textarea\"></textarea>\n    <p class=\"loading\" *ngIf=\"loading\">{{loadingTip}}</p>\n    `,\n    encapsulation: ViewEncapsulation.Emulated,\n    styles: [ `.ueditor-textarea{display:none;}` ],\n    providers: [{\n        provide: NG_VALUE_ACCESSOR,\n        useExisting: forwardRef(() => UEditorComponent),\n        multi: true\n    }],\n})\nexport class UEditorComponent implements OnDestroy, ControlValueAccessor {\n    static idPool = 0;\n\n    private instance: any;\n    private value: string;\n    private path: string;\n    private events:any = {};\n\n    loading: boolean = true;\n    id: string;\n\n    @Input() config: any;\n    @Input() loadingTip: string = '加载中...';\n    @ViewChild('host') host: ElementRef;\n\n    @Output() onPreReady = new EventEmitter<UEditorComponent>();\n    @Output() onReady = new EventEmitter<UEditorComponent>();\n    @Output() onDestroy = new EventEmitter();\n    @Output() onContentChange = new EventEmitter();\n\n    constructor(private el: ElementRef,\n                private zone: NgZone,\n                private ss: ScriptService,\n                private defConfig: UEditorConfig) {}\n\n    ngOnInit() {\n        this.path = this.defConfig && this.defConfig.path;\n        if (!this.path) this.path = './assets/ueditor/';\n\n        // 构建一个虚拟id\n        this.id = 'ueditor-' + ++UEditorComponent.idPool;\n        this.host.nativeElement.id = this.id;\n\n        // 已经存在对象无须进入懒加载模式\n        if (window.UE) {\n            this.init();\n            return;\n        }\n\n        this.ss.load(this.path, true).getChangeEmitter().subscribe(res => {\n            this.init();\n        });\n    }\n\n    private init(options?: any) {\n        if (!window.UE)\n            throw new Error('uedito js文件加载失败');\n\n        if (this.instance) return;\n\n        // registrer hook\n        if (this.defConfig && this.defConfig.hook) {\n            if (!this.defConfig._hook_finished) {\n                this.defConfig._hook_finished = true;\n                this.defConfig.hook(UE);\n            }\n        }\n\n        this.loading = false;\n        this.onPreReady.emit(this);\n        this.zone.runOutsideAngular(() => {\n            const opt = Object.assign({\n                UEDITOR_HOME_URL: this.path\n            }, this.defConfig && this.defConfig.options, this.config, options);\n\n            let ueditor = UE.getEditor(this.id, opt);\n            ueditor.ready(() => {\n                this.zone.run(() => {\n                    this.instance = ueditor;\n                    this.value && this.instance.setContent(this.value);\n                    this.onReady.emit(this);\n                });\n            })\n\n            ueditor.addListener('contentChange', () => {\n                this.updateValue(ueditor.getContent());\n            });\n        });\n    }\n\n    private updateValue(value: string){\n        this.zone.run(() => {\n            this.value = value;\n\n            this.onChange(this.value);\n            this.onTouched(this.value);\n\n            this.onContentChange.emit(this.value);\n        });\n    }\n\n    private destroy() {\n        if (this.instance) {\n            for (let ki of this.events) {\n                this.instance.removeListener(ki, this.events[ki]);\n            }\n            this.instance.removeListener('ready');\n            this.instance.removeListener('contentChange');\n            this.instance.destroy();\n            this.instance = null;\n        }\n        this.onDestroy.emit();\n    }\n\n    /**\n     * 获取UE实例\n     *\n     * @readonly\n     */\n    get Instance(): any {\n        return this.instance;\n    }\n\n    /**\n     * 设置编辑器语言\n     *\n     * @param {('zh-cn' | 'en')} lang\n     */\n    setLanguage(lang: 'zh-cn' | 'en') {\n        this.ss.loadScript(`${this.path}/lang/${lang}/${lang}.js`).then(res => {\n            this.destroy();\n\n            //清空语言\n            if (!UE._bak_I18N) {\n                UE._bak_I18N = UE.I18N;\n            }\n            UE.I18N = {};\n            UE.I18N[lang] = UE._bak_I18N[ lang ];\n\n            this.init();\n        });\n    }\n\n    /**\n     * 添加编辑器事件\n     */\n    addListener(eventName: EventTypes, fn: Function): void {\n        if (this.events[eventName]) return;\n        this.events[eventName] = fn;\n        this.instance.addListener(eventName, fn);\n    }\n\n    /**\n     * 移除编辑器事件\n     */\n    removeListener(eventName: EventTypes): void {\n        if (!this.events[eventName]) return;\n        this.instance.removeListener(eventName, this.events[eventName]);\n        delete this.events[eventName];\n    }\n\n    ngOnDestroy() {\n        this.destroy();\n    }\n\n    writeValue(value: string): void {\n        this.value = value;\n        if(this.instance){\n            this.instance.setContent(this.value);\n        }\n    }\n\n    protected onChange: any = Function.prototype;\n    protected onTouched: any = Function.prototype;\n\n    public registerOnChange(fn: (_: any) => {}): void { this.onChange = fn; }\n    public registerOnTouched(fn: () => {}): void { this.onTouched = fn; }\n\n    setDisabledState(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.instance.setDisabled();\n        } else {\n            this.instance.setEnabled();\n        }\n    }\n}\n"]}